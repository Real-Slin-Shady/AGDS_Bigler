---
title: "Report Exercise 1 (Chapter 3)"
output: html_notebook
editor_options: 
  markdown: 
    wrap: 75
---

## Report Exercise 1

### Introduction

The following code chunk contains all packages we need for this exercise.
If we run the chunk, we activate the packages. Important is the package
"conflicted". It enables us to chose if different functions have the same
call but do not make the same thing (a function in a certain package can
have the same name as a function from another package).

```{r activate_the_packages}
#activate packages
library(tidyverse)
library(ggplot2)
library(knitr)
library(conflicted)
```

In this exercises the topic is the "Logarithmic Respond Ratio" (LRR). The
log response ratio is the natural logarithm of the response ratio and is
defined as followed:

$$LRR = \log\left(\frac{x_{eluvated}}{x_{ambient}}\right)$$

### Original source of the file

Here we us the original data from a paper of Groenigen et al (2014). In
this paper, we take a close look to the
$CO_2 - concentrations \: (\: [\frac{g}{m^{-2}}])$ in the experiments and
calculate the LRR. Because we want a comprehensive analysis of the data, we
calculate the LRR in different ways. For the ccientific reproducibility,
you will find the original source is the following article:

*Groenigen, Kees Jan van, Xuan Qi, Craig W. Osenberg, Yiqi Luo, and Bruce
A. Hungate. "Faster Decomposition Under Increased Atmospheric CO2 Limits
Soil Carbon Storage." Science 344, no. 6183 (May 2, 2014):
508--9.Â <https://doi.org/10.1126/science.1249534>.*

### Editing the file manually

Unfortunately, the original file is not well structured. It has multiples
headers and empty spaces which complicates to read the file and therefore,
we must the file edit manually. The Excel software (MS Office 360 with the
license from the University of Bern, status: yyyy-mm-dd) is used for this
task. The following points were changed manually:

1.  Extracted the sheet "Database S1" and saved it in a new Excel file

2.  All empty rows between two different experiments removed.

3.  Removed all the headings and subheadings of the sheet. Now has each
    column the same length.

4.  Removed the header with the unit [g C m\^-2] for the columns at points
    6, 7, 8 and 9

5.  In the "Experiment" column, the corresponding experiment was assigned
    to each cell.

6.  Column "ambient $CO_2$" with the header "mean" renamed to "mean ambient
    CO2"

7.  Column "increased $CO_2$" with the header "mean" renamed to "mean
    increased CO2"

8.  Column "ambient $CO_2$" with the header "n" renamed to "n ambient CO2"

9.  Column "increased $CO_2$" with the header "n" renamed to "n increased
    CO2"

10. File converted from a .xlsx file to a .csv file

### Method and evaluation of the data

After manual editing the csv file can be read with the software R-Studio
(Version: 2022.12.0 +353 ). This software use the language R to handle the
data. In this part of the report it is shown how the data was read and
processed with the software.

#### Read the csv file, get a overview of the data and data controlling

The following code chunk shows how the file was read. To calculate the LRR,
the columns "mean ambient CO" and "mean increased CO2" are needed.
Therefore they must have the class "numeric" which the following code chunk
check as well. Additional it is advantageous, if there are not any missing
values. This is why we check this as well. The response said, that the
needed columns has the right class and there are no missing values.
Therefore there is no need to change anything.

```{r read_csv_data_and_check_the_classes}
# read in in the csv table as a data frame
database_S1 <- read_csv("/Users/patrick/AGDS_Report/database_S1_csv.csv",
                        show_col_types = FALSE)

# check the classes of each column (we will calculate --> class must be numeric)
sapply(database_S1, class)

# We check, weather there are missing values
is.na(database_S1)
```

#### Calculate the LRR for each experiment

For the first task we calculate the LRR for each experiment. For an
efficient processing of the data we can use the R-package "Tidyverse". But
we can calculate the LRR with two different methods:

Method 1: Firstly, we group the database by 'Experiment'. Secondly, we
calculate the mean for the columns "mean ambient CO2" and "mean increased
CO2" columns (for each experiment). Thirdly, we calculate the LRR with the
values.

Method 2: Firstly, we calculate the LRR for each row. Secondly, we group
the database by "Experiment". Thirdly, we take the mean of all LRR of each
experiment.

Although the results of both methods are the LRR for each experiment they
are in general different. Therefore it is important which method we chose.
In this case it is more meaningful to use method 2 because every experiment
has a sample date. In this setup are the CO2 concentrations fixed. It makes
more sense that we take this in to account and calculate the LRR for a
specific sample date. If we use method 1 we would calculate LRR with a CO2
concentration which never existed in the experiment setup. With method 2 we
use concentrations who has been measured in an experiment and it makes
therefore more sense.

#### Calculate the LRR for each experiment (grouped by phase)

In this second task the experiments are divided into three phases
accounting the duration of the experiment.

1)  Phase "early" $\Longrightarrow$ lesser than 3 years

2)  Phase "med" $\Longrightarrow$ between 3 and 6 years

3)  Phase "late" $\Longrightarrow$ greater than 6 years

For an efficient way to processing the data we use "Tidyverse" again. Here,
we are confronted with the same problem as in the first task because there
are again the two methods to calculate the LRR for each phase (same
considerations and the same argumentation as in task 1).

#### Coding

The following code chunk shows how to calculate the LRR for both tasks and
both methods. As you can see, the results of Method 1 and Method 2 are
different. In this case, Method 2 is more meaningful than Method 1. But
this is not always the case. It is therefore important to consider what
exactly you want to analyze and what is the context of the experiment.

```{r Calculate_the_LRR}
# a little preparation..
# dplyr:: is use because of the package "conflicted".
# If two functions have the same name it allows to choose the right package.

DB_S1 <- database_S1|>
# Group the database according to the "Experiment" column  
  group_by(Experiment) |>
# Select only the columns which are needed  
  dplyr::select(Experiment,`Time (years)`, starts_with("mean")) |>
# Filter the database for all experiments that run less than three years
  dplyr::filter(`Time (years)`< 3) |>
# Call this phase "early"  
  mutate(Phase = "early") |>
# Use "bind_row" because not all rows have been used yet. 
# The phase for the other rows should be in the same column. 
# Iterate the procedure for all the other phases   
  bind_rows(database_S1 |>
  dplyr::select(Experiment,`Time (years)`,starts_with("mean")) |>
  dplyr::filter(`Time (years)`  >= 3 & `Time (years)` <= 6) |>
  mutate(Phase = "mid")) |>
  bind_rows(database_S1 |>
  dplyr::select(Experiment,`Time (years)`, starts_with("mean")) |>
  dplyr::filter(`Time (years)` > 6) |>
  mutate(Phase = "late")) |>
  group_by(Experiment) |>
# Seelct only the columns which are needed  
  dplyr::select("Experiment", "mean ambient CO2", "mean increased CO2", "Phase")

# calculate the LRR for each experiment with both methods
DB_S1 |>
  group_by(Experiment) |>
  summarise(LRR_Method_1 = 
              log(mean(`mean ambient CO2`) /  mean(`mean increased CO2`)),
              LRR_Method_2 = 
              mean(log(`mean ambient CO2`/ `mean increased CO2`)))

# calculate the LRR for each phase with both methods
DB_S1 |>
  group_by(Phase) |>
  summarise(LRR_Method_1 = 
              log(mean(`mean ambient CO2`) /  mean(`mean increased CO2`)),
            LRR_Method_2 = 
              mean(log(`mean ambient CO2`/ `mean increased CO2`)))
```
